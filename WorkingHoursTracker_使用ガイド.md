# Working Hours Tracker - 使用ガイド

## 概要

このスキルは、Discord（特に#telapoチャンネル）でユーザーの稼働時間を追跡し、1時間ごとの進捗確認を自動的に行い、1日の終わりにサマリーを生成します。

## 機能

1. **稼働時間の記録**: ユーザーが作業開始・終了時間を指定
2. **時間追跡**: 1時間ごとに進捗確認のジョブを自動作成
3. **進捗記録**: ユーザーの進捗更新を履歴として記録
4. **日次サマリー**: 作業終了時にその日の成果をまとめて報告

## 使い方

### 1. 稼働時間を設定する

Discordチャンネル（#telapoなど）で以下のようにメッセージを送ります：

```
今日は9時から18時まで働きます
```

または

```
Start work 9am-6pm
```

または

```
9:00-18:00
```

Botは以下を認識します：
- 日本語形式: "9時"、"9時30分"、"午前9時"、"午後6時"
- 12時間表記: "9am"、"9:30am"、"6:30pm"
- 24時間表記: "9:00"、"9:30"、"18:00"、"18:30"

### 2. 進捗確認への応答

1時間ごとにBotから以下のメッセージが届きます：

```
進捗どうですか？
```

以下のように応答します：

```
完了しました
```

または

```
進捗：設計完了、実装中
```

または

```
Working on frontend
```

Botは進捗を記録し、次の確認時間を知らせます：

```
進捗を記録しました。次は11:00です。
```

### 3. 作業を早めに終了する

予定より早く作業を終了したい場合：

```
今日はこれで稼働終わります
```

または

```
End work
```

Botは以下を行います：
1. その時点までの進捗履歴を収集
2. 1日の作業サマリーを生成
3. 未実行の進捗確認ジョブをすべてキャンセル
4. サマリーをチャンネルに送信

## サマリーのフォーマット

作業終了時（または予定終了時間）に、以下の形式でサマリーが送信されます：

```
📊 本日の作業サマリー - 2026年1月26日

⏰ 作業時間
  開始: 09:00
  終了: 18:00
  合計: 9時間

📝 進捗更新履歴
  10:00: 設計完了、実装中です
  11:00: フロントエンド実装完了
  12:00: バックエンド実装中
  13:00: API連携中
  14:00: テスト実施
  15:00: バグ修正完了
  16:00: デプロイ準備
  17:00: デプロイ完了

💡 今日の成果まとめ
  本日は設計から実装、API連携、テストを経てデプロイまで完了しました。
  主な成果物としてフロントエンドとバックエンドの両方を完成させることができました。
```

## サポートされる時間形式

| 形式 | 例 |
|--------|------|
| 日本語 | "9時"、"9時30分"、"午前9時"、"午後6時" |
| 12時間制 | "9am"、"9:30am"、"6:30pm" |
| 24時間制 | "9:00"、"9:30"、"18:00"、"18:30" |
| 区切り文字 | "9時から18時まで"、"9:00-18:00"、"9:00～18:00" |

## 技術仕様

### データの保存場所
- 作業データ: `~/.clawdbot/skills/working-hours-tracker/working-hours.json`
- ユーザーごとに以下を記録：
  - 稼働開始・終了時間
  - チャンネルID
  - 進捗更新履歴
  - タイムゾーン（デフォルト: Asia/Tokyo）

### Cronジョブ
ユーザーが稼働時間を設定すると、以下のジョブが自動作成されます：

1. **進捗確認ジョブ**: 1時間ごとに実行
   - 名前: `progress-<user_id>-<date>-<time>`
   - スケジュール: 特定時刻（`at`）
   - セッション: isolated（独立セッションで実行）
   - メッセージ: "進捗どうですか？"
   - 配信元チャンネルへ送信

2. **日次サマリージョブ**: 終了時間に実行
   - 名前: `summary-<user_id>-<date>-<end_time>`
   - スケジュール: 終了時刻（`at`）
   - セッション: isolated（独立セッションで実行）
   - メッセージ: その日の進捗をまとめて生成
   - 配信元チャンネルへ送信
   - 実行後自動削除

## 注意事項

1. **タイムゾーン**: デフォルトは `Asia/Tokyo` です。他のタイムゾーンを使用する場合、Botに設定を依頼してください。
2. **複数ユーザー**: 複数のユーザーが同時に異なる稼働時間を設定可能です。
3. **早め終了**: 予定終了時間より早く終了した場合、残りの進捗確認ジョブは自動キャンセルされます。
4. **データ永続化**: Botを再起動しても作業データは保持されます。
5. **エラー時**: ジョブ作成に失敗した場合、Botがエラーを通知し、再試行します。

## トラブルシューティング

### 進捗確認が来ない場合

1. Gatewayが実行中か確認：
   ```bash
   clawdbot gateway status
   ```

2. Cronジョブを確認：
   ```bash
   clawdbot cron list
   ```

3. Gatewayを再起動：
   ```bash
   taskkill /F /IM node.exe
   clawdbot gateway --port 18789
   ```

### 時間が正しく認識されない場合

以下の形式を試してください：
- "9時から18時まで"
- "9:00-18:00"
- "09:00-18:00"

### Botが応答しない場合

1. Botがチャンネルに参加しているか確認
2. Botにメンションしているか確認（@clawdbot）
3. ギルド設定を確認

## よくある質問

**Q: 稼働時間を変更できますか？**
A: はい。現在の進捗確認ジョブをキャンセルし、新しい時間で再設定できます。

**Q: 昼休みを入れたいのですが？**
A: 現在のスキルでは対応していません。昼休み期間を除いた稼働時間を設定してください（例：9:00-12:00、13:00-18:00）。

**Q: 進捗をスキップできますか？**
A: はい。Botからのメッセージは無視して進捗を記録しませんが、次の確認時間には通常通りメッセージが届きます。

**Q: 複数のチャンネルで使用できますか？**
A: はい。各チャンネルで独立して稼働時間を設定できます。

**Q: サマリーを別のチャンネルにも送信できますか？**
A: 現在のスキルでは、稼働開始したチャンネルにのみ送信されます。

## 更新履歴

- 2026年1月26日: 初版リリース
  - 稼働時間設定
  - 1時間ごとの進捗確認
  - 日次サマリー生成
  - 日本語・英語両対応

## サポート

問題が発生した場合は、以下を確認してください：
1. Gatewayが実行中か
2. Discord Botの接続状態
3. 設定ファイル（clawdbot.json）のskillsセクション

---

**開発者**: Sisyphus
**作成日**: 2026年1月26日
**バージョン**: 1.0.0
