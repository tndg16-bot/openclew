# Clawdbot 設定テンプレート

このファイルはClawdbotの設定のテンプレートです。実際の設定ファイルは以下の場所にあります：

**Windows:** `C:\Users\<ユーザー名>\.clawdbot\clawdbot.json`

## Discord Bot 設定

`clawdbot.json` の `channels.discord` セクションを以下のように設定します：

```json5
{
  "channels": {
    "discord": {
      "enabled": true,
      "token": "ここにDiscord_Bot_Tokenをペースト",
      "groupPolicy": "allowlist",
      "guilds": {
        "あなたのサーバーID": {
          "users": ["bi6612"],
          "requireMention": true,
          "channels": {
            "general": { "allow": true }
          }
        }
      }
    }
  }
}
```

### 設定値の説明

| 設定項目 | 値 | 説明 |
|---------|-----|------|
| `enabled` | `true`/`false` | Discordチャンネルを有効化するか |
| `token` | 文字列 | Discord Bot Token（必須） |
| `groupPolicy` | `"open"`/`"allowlist"`/`"disabled"` | ギルドチャンネルのアクセスポリシー |
| `guilds.*.users` | 配列 | 許可するユーザーIDのリスト |
| `requireMention` | `true`/`false` | メンション時のみ応答するか |
| `channels.*.allow` | `true`/`false` | チャンネルを許可するか |

### IDの取得方法

1. Discord設定 → Advanced → **Developer Mode** を有効化
2. 右クリック → **Copy ID** でIDをコピー：
   - サーバー名 → サーバーID（Guild ID）
   - チャンネル名 → チャンネルID
   - ユーザー名 → ユーザーID

## 完全な設定例

```json5
{
  "messages": {
    "ackReactionScope": "group-mentions"
  },
  "agents": {
    "defaults": {
      "workspace": "C:\\Users\\<ユーザー名>\\clawd",
      "model": {
        "primary": "anthropic/claude-3-5-sonnet"
      },
      "maxConcurrent": 4
    }
  },
  "gateway": {
    "mode": "local",
    "auth": {
      "mode": "token",
      "token": "gatewayの認証トークン"
    },
    "port": 18789,
    "bind": "loopback"
  },
  "auth": {
    "profiles": {
      "anthropic:default": {
        "provider": "anthropic",
        "mode": "api_key"
      }
    }
  },
  "channels": {
    "discord": {
      "enabled": true,
      "token": "あなたのDiscord_Bot_Token",
      "groupPolicy": "allowlist",
      "dm": {
        "enabled": true,
        "policy": "pairing"
      },
      "guilds": {
        "123456789012345678": {
          "users": ["987654321098765432"],
          "requireMention": true,
          "channels": {
            "general": { "allow": true },
            "bot-test": { "allow": true, "requireMention": false }
          }
        }
      }
    }
  },
  "plugins": {
    "entries": {
      "discord": {
        "enabled": true
      }
    }
  },
  "skills": {
    "install": {
      "nodeManager": "npm"
    }
  }
}
```

## アクセスポリシーの詳細

### DM（ダイレクトメッセージ）

```json5
"dm": {
  "enabled": true,
  "policy": "pairing",  // pairing | allowlist | open | disabled
  "allowFrom": ["ユーザーID1", "ユーザーID2"]
}
```

| ポリシー | 説明 |
|---------|------|
| `"pairing"` | 初回メッセージにコードを表示し、承認が必要（推奨、セキュア） |
| `"allowlist"` | `allowFrom` で指定したユーザーのみ許可 |
| `"open"` | 全員許可（`allowFrom: ["*"]` が必要） |
| `"disabled"` | DMを無効化 |

### ギルドチャンネル

```json5
"groupPolicy": "allowlist"  // open | allowlist | disabled
```

| ポリシー | 説明 |
|---------|------|
| `"open"` | 全てのギルド・チャンネルを許可 |
| `"allowlist"` | `guilds` で指定したギルド/チャンネルのみ許可（推奨） |
| `"disabled"` | ギルドチャンネルを無効化 |

## 複数のサーバーに対応する場合

```json5
"guilds": {
  "サーバーID1": {
    "users": ["ユーザーID"],
    "requireMention": true,
    "channels": {
      "general": { "allow": true }
    }
  },
  "サーバーID2": {
    "users": ["ユーザーID", "他のユーザーID"],
    "requireMention": false,
    "channels": {
      "*": { "allow": true }
    }
  }
}
```

## ワイルドカードの使用

```json5
"guilds": {
  "*": {              // 全てのギルドに適用
    "requireMention": true,
    "channels": {
      "*": { "allow": false }  // デフォルトは拒否
    }
  },
  "特定のサーバーID": {
    "channels": {
      "*": { "allow": true }  // このサーバーのみ全チャンネル許可
    }
  }
}
```

## 設定の適用

設定ファイルを変更した後、Gatewayを再起動してください：

```bash
# Gatewayがバックグラウンドで実行中の場合
clawdbot gateway --force

# 前景で実行中の場合は Ctrl+C で停止してから再実行
```

## 詳細情報

- 公式ドキュメント: https://docs.clawd.bot/channels/discord
- 設定リファレンス: https://docs.clawd.bot/gateway/configuration
